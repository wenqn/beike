## IP地址简介

[TOC]

导语

你给对方发QQ或微信时，Internet靠什么在数十亿的主机中准确找到对方的设备？找到对方在哪儿是Internet需要解决的核心问题。实际上连接到Internet上的每一台设备都至少有一个ip地址，Internet正是根据ip地址来找到每一台设备。

什么是IP地址[^1]

IP地址和我们的电话号码有很多相似之处。当我们给别人打电话时，你可以直接拨对方电话号码，但更多的情况下你会先查阅电话簿，找到名字再拨号，因为电话号码不容易记忆。不管是直接拨号还是通过电话簿，电话系统最终是通过电话号码来查找用户。

当我们访问Internet上的网站时有类似的情形。比如访问百度网站，一般我们会在浏览器地址栏里输入[www.baidu.com](http://www.baidu.com) ，这个域名就相当于手机里的电话簿。实际上我们还可以用另外一种方式登录百度，在浏览器里输入119.75.218.77，同样可以打开百度网页。这个“119.75.218.77”就是百度服务器的ip地址，相当于手机的电话号码。（百度服务器有很多，这只是其中之一）。我们几乎不会用ip地址的方式登录网站，因为不容易记忆，域名要方便的多。但最终，网络中查找计算机是通过ip地址而不是域名。

![](https://tcs.teambition.net/storage/312l7c5abe5511c186acbc8a113c5a4c21cb?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3NTI5OTQzOCwiaWF0IjoxNjc0Njk0NjM4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmw3YzVhYmU1NTExYzE4NmFjYmM4YTExM2M1YTRjMjFjYiJ9.Nz_swEQvOjjrQPlGV3-m8PHtYiue7VebUZ91EXPSyrQ&download=3_pingIP.png "")

> 通过ping命令可以查看到远程服务器的ip地址在菜单->运行中，输入 cmd，回车，打开命令提示符(cmd程序)，输入ping 域名，比如查看淘宝网，可以输入ping  ，返回信息里会包含到我们最快的一个服务器ip地址注意：ping命令的主要功能是检测网络连通情况，不是专业查看ip地址。

IP地址的表示方法

>  目前在用的IP有两个版本IPv4和IPv6，本课程中如果没有特别注明，IP地址指IPv4地址。

IP地址是一组32位的二进制数。但我们看到的IP地址一般类似119.75.218.77的形式，由四组十进制组成，由“.”号分隔开，这种方式称为“点分十进制”表示法。这种表示法只是为了方便人们的阅读。一般我们讨论IP地址都是指点分十进制形式。但要记得，在计算机内部都是用二进制表示。下表是一些点分十进制和二进制的对应。

| 四组点分十进制         | 二进制                                 |
| --------------- | ----------------------------------- |
| 0.0.0.0         | 00000000 00000000 00000000 00000000 |
| 1.2.3.4         | 00000001 00000010 00000011 00000100 |
| 10.0.0.255      | 00001010 00000000 00000000 11111111 |
| 165.195.130.107 | 10100101 11000011 10000010 01101011 |
| 255.255.255.255 | 11111111 11111111 11111111 11111111 |

点分十进制表示时，每一组都是一个非负整数，最小值为0，最大值为255。

> 思考：为什么ip地址每一组最大值是255？每一组十进制数对应一组8位的二进制，从00000000到11111111，对应的十进制数是0到255

IP地址结构

先看我们的手机号码，有如下结构

| 182     | 6438     | 8861    |
| ------- | -------- | ------- |
| 运营商（3位） | 地区编码（4位） | 用户标识（4） |

IP地址的结构可以分为网络号和主机号两部分。网络号标识一个网络地址，主机号标识这段网络里的一台具体主机。

| 网络号       | 主机号       |
| --------- | --------- |
| 119       | 75.218.77 |
| 192.168.1 | 243       |

与手机号不同的是，手机号码的3+4+4结构是固定不变的，IP地址的网络号和主机号却是不固定的。那么Internet如何区分哪一部分是网络号，哪一部分是主机号呢？IP地址在设计时规定了5种地址类型，每种类型固定了其网络号和主机号的长度。

IP地址分类

考虑到现实中不同网络可能有不同数量的主机，每台主机需要一个唯一ip地址。最初设计ip地址时，将ip地址空间分成A、B、C、D、E五类，每一类包含的网络数量和主机数量各不相同。在设计网络时，工程师需要基于当前或预计的主机数量，参考这些分类，选择一种类型进行分配ip地址。

下图是IPv4五类地址示意图

![](https://tcs.teambition.net/storage/312l393aaa0e7a4f52da6807b92fd84f8576?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3NTI5OTQzOCwiaWF0IjoxNjc0Njk0NjM4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmwzOTNhYWEwZTdhNGY1MmRhNjgwN2I5MmZkODRmODU3NiJ9.ICvTjBDOxsyLLLqVTQnqB5HBzO7FSGEkxyEo6tBUVEQ&download=3_ip%E5%9C%B0%E5%9D%80%E5%88%86%E7%B1%BB.png "")

这五类地址的划分依据是二进制IP地址第一组二进制数的前四位（也成为“高序位”），A类地址的第1位为0，网络号有7位（第一组二进制数），主机号有24位。B类地址的前两位为10，网络号有14位（前两组二进制数），主机号有16位。C类地址的前3位为110，网络号有21位（前三组二进制数），主机号有8位。D、E类网络一般很少使用。D类地址的前4位为1110，作为组播地址使用。E类地址的前4位为1111，保留地址。

点分十进制IP地址可分配范围

每类地址实际上限制了可分配的网络数量和所能容纳的最大主机数量。在规划网络时，需要考虑你的网络里需要容纳多少台主机，从A、B、C类网络里选择一种类型。如果选择类型过大，会造成过多ip地址浪费。如果选择类型太小，可能面临没有足够的ip地址分配。

下面以B类地址为例，计算一下点分十进制ip地址范围

| 二进制最小值 | 10000000 | 00000000 | 00000000 | 00000000 |
| ------ | -------- | -------- | -------- | -------- |
| 对应十进制  | 128      | 0        | 0        | 0        |
| 二进制最大值 | 10111111 | 11111111 | 11111111 | 11111111 |
| 对应十进制  | 191      | 255      | 255      | 255      |

因此B类地址的点分十进制IP地址范围为128.0.0.0~191.255.255.255

下表展示了每类IP地址的分配范围、可分配网络数和最大主机数量

| 类型  | 地址范围                      | 高序位  | 网络数量    | 主机数量     |
| --- | ------------------------- | ---- | ------- | -------- |
| A类  | 0.0.0.0-127.255.255.255   | 0    | 128     | 16777216 |
| B类  | 128.0.0.0-191.255.255.255 | 10   | 16384   | 65536    |
| C类  | 192.0.0.0-223.255.255.255 | 110  | 2097152 | 256      |
| D类  | 224.0.0.0-239.255.255.255 | 1110 | N/A     | N/A      |
| E类  | 240.0.0.0-255.255.255.255 | 1111 | N/A     | N/A      |

> 单播地址能够分配给主机的地址称为单播地址。在IPv4地址块中，有两类主机号是不能分配给主机的。这就是全0地址和全1地址全0地址：代表整个网段，而不是具体某台主机，比如192.168.1.0全1地址：广播地址，指该网段的所有主机，比如192.168.1.255，发送到广播地址的信息会被该网段所有主机接收到。这两个地址不能分配给具体主机使用。所以，实际可分配主机数量需要减去2，比如C类地址的主机数量为256，实际可分配的主机地址为256-2=254。

IP地址类型判别

判断IP地址属于哪一类地址也是常见的一种要求。一般我们有两种方法判断。

1. 二进制地址，根据地址头几位定义：0——A类，10——B类，110——C类，1110——D类组播地址，1111——E类保留地址

1. 点分十进制，根据第一组十进制数判定0-127——A类，128-191——B类，192-223——C类，224-239——D类，240-255——E类

如果进制转换比较熟悉，可以将二进制转换成十进制，或反过来，按自己熟悉的进制进行判断

> 练习：判断一下百度IP：119.75.218.77，淘宝IP：123.129.215.178，淄博五中IP ：222.134.153.158分别属于哪类ip地址？

*子网掩码

一个A类网络可容纳16777216台主机，现实中几乎见不到需要容纳1千万台机器的局域网。如何在不改变A、B、C、D、E五类的基础上划分出更小的网络？这是个非常常见的现实问题。子网掩码可以很好的解决这个问题。

子网掩码设置在路由器和主机上，用于确定一个IP地址的网络部分和主机部分。子网掩码由连续的一串1后面跟一串连续的0组成，长度共32位，和IP地址长度相同，表示方法也和IP地址相同，可以用二进制也可以用点分十进制。子网掩码中的一位设置为1表示IP地址对应位作为网络号一部分。相反，子网掩码中的一位设为0，表示一个IP地址的对应位作为主机号的一部分。下表列举了三种常见子网掩码的点分十进制表示和二进制表示。

| 点分十进制掩码       | 二进制掩码                               |        |
| ------------- | ----------------------------------- | ------ |
| 255.0.0.0     | 11111111 00000000 00000000 00000000 | A类地址掩码 |
| 255.255.0.0   | 11111111 11111111 00000000 00000000 | B类地址掩码 |
| 255.255.255.0 | 11111111 11111111 11111111 00000000 | C类地址掩码 |

子网寻址与划分[^2]

把一个大网络通过掩码分割成许多小网络，这叫子网划分，是子网掩码的一个重要应用。其思路是将主机号的一部分（左边的位）拿出来做子网络号，剩余的部分做子网主机号。支持此功能的方法称为子网寻址。

![](https://tcs.teambition.net/storage/312lc1e6e2334e44ae11dd9a12ddb24b4f15?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3NTI5OTQzOCwiaWF0IjoxNjc0Njk0NjM4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmxjMWU2ZTIzMzRlNDRhZTExZGQ5YTEyZGRiMjRiNGYxNSJ9.YOOOFXtosFT7fe39qg5jjZU_hgQfWNcpOHWFsxZtGrE&download=3_%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86.png "")

这种做法改变A、B、C类网络基础地址中的网络部分和主机部分的限制。需要通过子网掩码来确定实际的网络部分和主机部分。

IP地址与掩码进行“与”运算，其结果便是网络号。下图中，一个B类地址128.32.1.14与C类掩码运算后（255.255.255.0），得到其网络部分128.32.1.0/24。“/24”表示该地址前24位为网络地址，同理“/8"表示地址前8位为网络地址，依此类推。

![](https://tcs.teambition.net/storage/312la46836898f0a581e6c198c3a4c09ed30?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3NTI5OTQzOCwiaWF0IjoxNjc0Njk0NjM4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmxhNDY4MzY4OThmMGE1ODFlNmMxOThjM2E0YzA5ZWQzMCJ9.iGSc4YDmTOnoe-UqcRjvdgcK1DYNmDJ-3veg3-CwGTA&download=3_%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80.png "")

> 掩码运算后，原ip地址第三组（00000001）由主机号变为子网络号，子网数量一共256个（从00000000到11111111共2^8个），这256个子网地址依次是128.32.0.0/24，128.32.1.0/24，128.32.2.0/24，128.32.3.0/24，……，128.32.254.0/24，128.32.255.0/24。C类掩码的最后8位二进制表示主机号，从0000000——11111111共256个。去掉全0的网络地址和全1的广播地址，每个子网可分配的主机地址为254个。所以，一个B类网络与C类地址掩码运算后，被分成256个小网络（网络号由原来16位变成24位），每个小网络里有254个主机地址（去掉全0和全1地址）。

掩码先进行取反操作（将0变成1,1变成0的操作），再与IP地址进行“或”运算，将得到主机号部分。

![](https://tcs.teambition.net/storage/312l2ee2258bf669f554bc38a0667de26b94?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3NTI5OTQzOCwiaWF0IjoxNjc0Njk0NjM4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmwyZWUyMjU4YmY2NjlmNTU0YmMzOGEwNjY3ZGUyNmI5NCJ9.WOYFCnDYnF6FPhkOlO3D4iUuVpRObap-7BWCIkWMeeY&download=3_%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81%E4%B8%BB%E6%9C%BA%E5%9C%B0%E5%9D%80.png "")

> **逻辑运算与**运算：​    运算符：AND​    规则：只有 AND两边都是1时，结果才是1，有一个0，结果就是0。1 AND 1 = 1， 1AND 0 = 0，0 AND 1=0，0 AND 0 = 0 。​    其逻辑类似电路里的串联电路，两个开关同时接通（都是1），灯泡才亮（结果为1）**或**运算​    运算符：OR​    规则：只要OR两边有一个1，结果就是1。1 OR 0 =1， 0 OR 1 = 1， 1 OR  1 = 1， 0 OR 0 = 0​    其逻辑类似电路里的并联电路，只要有一个分支电路接通（至少一个1），灯泡就亮（结果为1）

默认子网掩码

实际上，A、B、C类型网络的划分，可以看成是特殊的子网掩码的作用结果（实际上先有5种网络类型，后出现的子网掩码）。A类网络的默认子网掩码是255.0.0.0，前8位表示网络部分，后24位表示主机部分。B类网络的默认子网掩码是255.255.0.0，前16位表示网络部分，后16位表示主机部分。C类网络的默认子网掩码是255.255.255.0，前24位表示网络部分，最后8位表示主机部分。下图很清楚的说明了这点。

![](https://tcs.teambition.net/storage/312lfd61fdda8df443cc53929476bb5f9c48?Signature=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBcHBJRCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9hcHBJZCI6IjU5Mzc3MGZmODM5NjMyMDAyZTAzNThmMSIsIl9vcmdhbml6YXRpb25JZCI6IiIsImV4cCI6MTY3NTI5OTQzOCwiaWF0IjoxNjc0Njk0NjM4LCJyZXNvdXJjZSI6Ii9zdG9yYWdlLzMxMmxmZDYxZmRkYThkZjQ0M2NjNTM5Mjk0NzZiYjVmOWM0OCJ9.iPfLDKj35EzpdTXF85fbJ2S86cVZV5beqJGP7U0lxVE&download=3_%E9%BB%98%E8%AE%A4%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81.jpg "")

| A类地址                     | 网络号（8位）  | 主机号（24位）                   |
| ------------------------ | -------- | -------------------------- |
| 默认子网掩码         255.0 0.0 | 11111111 | 00000000 00000000 00000000 |

| B类地址              | 网络号（16位）          | 主机号（16位）          |
| ----------------- | ----------------- | ----------------- |
| 默认子网掩码255.255.0.0 | 11111111 11111111 | 00000000 00000000 |

| C类地址                | 网络号（24位）                   | 主机号（8位）  |
| ------------------- | -------------------------- | -------- |
| 默认子网掩码255.255.255.0 | 11111111 11111111 11111111 | 00000000 |

你可以猜到，只要灵活的控制子网掩码中1和0的个数，就可以在原来的A、B、C类网络里自由划分新的网络。下表列出了另外一些常用子网掩码的例子

| 点分十进制表示         | 二进制表示                               |
| --------------- | ----------------------------------- |
| 255.192.0.0     | 11111111 11000000 00000000 00000000 |
| 255.255.254.0   | 11111111 11111111 11111110 00000000 |
| 255.255.255.128 | 11111111 11111111 11111111 10000000 |

IPv4的弊端

IPv4由IANA(The Internet Assigned Numbers Authority，互联网数字分配机构)进行全球分配，虽然解决了地址的分配问题，但也面临一些弊端。主要是A、B类地址的主机部分显得太大，实际上几乎没有一个局域网能拥有A类地址那么多数量的主机，造成大量ip号浪费。同时，C类地址又显得过小，容纳不了太多主机。更重要的一点，IPv4的地址总量是有限的，已经跟不上互联网增长的速度。IPv4地址有32位，理论上具有4294967296个可能地址。2011年2月3日，IPv4地址已经全部分配完毕。作为IPv4的替代方案，IPv6将是未来的方向。IPv6地址有128位，长度是IPv4的4倍，可分配的地址个数为        

> 

届时“地球上每一粒沙子都有一个ip地址”。

> 思考：IPv4地址在2011年已经分配完毕，为什么现在仍然可以买新的设备上网？为了解决IPv4地址短缺问题，尤其我国公网ip地址少的可怜，人们发明了NAT技术：多台主机共享一个公网ip。另一方面，正在推行的IPv6将会解决地址短缺问题。

参考

[^1]: 部分内容参考自网易公开课之华南师范大学公开课《信息社会传奇——计算机网络》第四讲《解决网络信息交互》 [http://open.163.com/special/cuvocw/jisuanjiwangluo.html](http://open.163.com/special/cuvocw/jisuanjiwangluo.html)



[^2]: 部分图、表引自凯文 R. 福尔，W. 理查德·史蒂文斯. TCP/IP详解卷1：协议[M]. 吴英，张玉，许昱玮，北京：机械工业出版社，2016:21-28

***

淄博五中信息中心版权所有